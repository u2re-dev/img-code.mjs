const A=(()=>{const A=[];for(let e=0;e<256;e++){let n=e;for(let A=0;A<8;A++)n=1&n?3988292384^n>>>1:n>>>1;A.push(n)}return A})(),e=new Uint8Array([139,74,78,71,13,10,26,10]),n=new Uint8Array([137,80,78,71,13,10,26,10]),t=new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]),r={type:"image/png"},a={type:"image/jpeg"},o=new TextDecoder,i=(A,e)=>A.filter((({type:A})=>A.toUpperCase()==e)),l=(A,e)=>{const n=new Uint8Array(A),t=new DataView(A);for(let A=0;A<e.length;A++)if(n[A]!==e[A])throw Error("Wrong signature");let r=e.length,a=[];for(;r+12<=t.byteLength;){const A=t.getUint32(r,!1),e=o.decode(n.subarray(r+4,r+8)),i=n.subarray(r+8,r+8+A),l=n.subarray(r,r+12+A);if(r+12+A>t.byteLength)break;a.push({type:e,A,data:i,t:l}),r+=12+A}return a},s=e=>{if(e[13])throw Error("Only PNG alpha compression supported");const n=new Uint8Array(25);n.set(new Uint8Array([0,0,0,13,73,72,68,82]),0),n.set(new Uint8Array(e.buffer,e.byteOffset+0,8),8),n.set(new Uint8Array([e[12],0,0,e[14],e[15]]),16);const t=((e,n=-1)=>{let t=n;for(let n=0;n<e.length;n++)t=t>>>8^A[255&(t^e[n])];return~t>>>0})(n.subarray(4,21));return n.set(new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t]),21),n},w=(A,e)=>{const n=new VideoFrame(A,{timestamp:0,alpha:"discard"});return n.copyTo(e,{format:"RGBX"}),n.close(),e};export const decodeJNG=async A=>{const o=(A=>{const n=l(A,e);return console.log(n),{o:n,i:i(n,"JDAT").map((A=>A.data)),l:i(n,"JDAA").map((A=>A.data)),p:i(n,"IDAT").map((A=>A.t))}})(A),c=new Blob(o.i,a);let y=null;if(o.p?.length>0){const A=o.o.find((({type:A})=>"JHDR"==A));console.log(o.p),y=new Blob([n,s(A.data),...o.p,t],r)}else o.l?.length>0&&(y=new Blob(o.l,a));const p={I:"none",B:"default"},I=await createImageBitmap(c,p),Q=y?await createImageBitmap(y,p):null,g=(Q?await(Promise.try((async()=>{const A=I.width*I.height*4,e=0+A,n=(A=>{if(Uint8Array.fromBase64)return Uint8Array.fromBase64(A);if("undefined"==typeof atob)throw Error("atob not available");const e=atob(A),n=e.length,t=new Uint8Array(n);for(let A=0;A<n;A++)t[A]=e.charCodeAt(A);return t})("AGFzbQEAAAABCAFgBH9/f38AAwIBAAUFAQEQgEAHGAIGbWVtb3J5AgALbWVyZ2VfYWxwaGEAAArUAQHRAQMBfwR7A38CQANAIAQgA08NASABIARq/QAEACEFIAIgBGr9AAQAIQYgBiAG/Q0ABAgMAAQIDAAECAwABAgMIQcgBSAH/Q0AAQIQBAUGEQgJChIMDQ4TIQggACAEaiAI/QsEACAEQRBqIQQMAAsLAkADQCAEIANPDQEgASAEaiEJIAIgBGohCyAAIARqIQogCiAJLQAAOgAAIApBAWogCUEBai0AADoAACAKQQJqIAlBAmotAAA6AAAgCkEDaiALLQAAOgAAIARBBGohBAwACwsL"),t=(await WebAssembly.instantiate(n)).instance.exports;t.memory.grow(2*A/65536);const r=t.memory.buffer;w(I,new Uint8ClampedArray(r,0,A)),w(Q,new Uint8ClampedArray(r,e,A)),t.merge_alpha(0,0,e,A);const a=new Uint8ClampedArray(r,0,A);return new ImageData(a,I.width,I.height,{})}))?.catch?.(console.warn.bind(console))):null)??I,B=new OffscreenCanvas(I.width,I.height);return B.getContext("2d",{desynchronized:!0,willReadFrequently:!0,antialias:!1,powerPreference:"low-power",premultipliedAlpha:!1})?.[g instanceof ImageData?"putImageData":"drawImage"]?.(g,0,0),(async(A,e)=>{const t=new Set(["JDAT","JDAA","IDAT","IHDR","JHDR","IEND","JSEP"]),a=e.filter((({type:A})=>!t.has(A.toUpperCase()))).map((({t:A})=>A)),o=(A=>{const e=l(A,n);return[n,...e.filter((A=>"sRGB"!==A.type)).map((A=>A.t))]})(await A.arrayBuffer());return o.splice(2,0,...a),new Blob(o,r)})(await B.convertToBlob(r),o.o)};