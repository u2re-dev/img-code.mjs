const A=(()=>{const A=[];for(let e=0;e<256;e++){let t=e;for(let A=0;A<8;A++)t=1&t?3988292384^t>>>1:t>>>1;A.push(t)}return A})(),e=new Uint8Array([139,74,78,71,13,10,26,10]),t=new Uint8Array([137,80,78,71,13,10,26,10]),r=new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]),n={type:"image/png"},a={type:"image/jpeg"},o=new TextDecoder,i=(new TextEncoder,(A,e)=>A.filter((({type:A})=>A.toUpperCase()==e))),B=(A=>{if(Uint8Array.fromBase64)return Uint8Array.fromBase64(A);if("undefined"==typeof atob)throw Error("No-atob");const e=atob(A),t=e.length,r=new Uint8Array(t);for(let A=0;A<t;A++)r[A]=e.charCodeAt(A);return r})("AGFzbQEAAAABEAJgBH9/f38AYAR/f39/AX8CDwEDZW52Bm1lbW9yeQIAAQMDAgABBw0CA21hYwAAA3dwaQABCuQEAtEBAwF/BHsDfwJAA0AgBCADTw0BIAEgBGr9AAQAIQUgAiAEav0ABAAhBiAGIAb9DQAECAwABAgMAAQIDAAECAwhByAFIAf9DQABAhAEBQYRCAkKEgwNDhMhCCAAIARqIAj9CwQAIARBEGohBAwACwsCQANAIAQgA08NASABIARqIQkgAiAEaiELIAAgBGohCiAKIAktAAA6AAAgCkEBaiAJQQFqLQAAOgAAIApBAmogCUECai0AADoAACAKQQNqIAstAAA6AAAgBEEEaiEEDAALCwuOAwEOfyAAQfgAOgAAIABBAWpBAToAACAAQQJqIQcgAkEEbEEBaiEEIAQgA2whBUEBIQhBACEJQQAhCgJAA0AgCiAFTw0BIAUgCmshDSANQf//AyANQYCABEkbIQwgDCANRiEOIAdBAUEAIA4bOgAAIAdBAWogDEH/AXE6AAAgB0ECaiAMQQh2OgAAIAdBA2pB/wEgDEH/AXFzOgAAIAdBBGpB/wEgDEEIdnM6AAAgB0EFaiEHIAohCwJAA0AgCiALIAxqTw0BIAogBHAhDyAPRQRAIAdBADoAACAHQQFqIQcgCkEBaiEKBSAKIARuIRAgCiAEcEEBayERIAEgECACQQRsbCARamohBiAGLQAAIQ8gByAPOgAAIAggD2ohCCAIQf//A3EhCCAJIAhqIQkgCUH//wNxIQkgB0EBaiEHIApBAWohCgsMAAsLDAALCyAHIAlBCHY6AAAgB0EBaiAJQf8BcToAACAHQQJqIAhBCHY6AAAgB0EDaiAIQf8BcToAACAHQQRqIQcgByAAaw8L"),w=A=>new Uint8Array([A>>>24&255,A>>>16&255,A>>>8&255,255&A]),E=(e,t=4294967295)=>{for(let r=0;r<e.length;r++)t=t>>>8^A[255&(t^e[r])];return t},g=(A,e=4294967295)=>{for(let t of A)e=E(t,e);return~e>>>0},I=(A,e=-1)=>~E(A,-1)>>>0,Q=A=>{if(A[13])throw Error("No PNG alpha.");const e=new Uint8Array(25);return e.set(new Uint8Array([0,0,0,13,73,72,68,82]),0),e.set(new Uint8Array(A.buffer,A.byteOffset+0,8),8),e.set(new Uint8Array([A[12],0,0,A[14],A[15]]),16),e.set(w(I(e.subarray(4,21))),21),e},C=(A,e)=>{const t=new Uint8Array(25);return t.set(new Uint8Array([0,0,0,13,73,72,68,82]),0),t.set(w(A),8),t.set(w(e),12),t.set(new Uint8Array([8,6,0,0,0]),16),t.set(w(I(t.subarray(4,21))),21),t},y=async(A,e)=>{const t=new VideoFrame(A,{timestamp:0,alpha:"discard"});return await t.copyTo(e,{format:"RGBX"}),t.close(),e},s=A=>{const e=new Uint8Array([73,68,65,84]);return[w(A.length),e,A,w(g([e,A]))]};export const decodeJNG=async A=>{const w=(A=>{const t=((A,e)=>{const t=new Uint8Array(A),r=new DataView(A);for(let A=0;A<e.length;A++)if(t[A]!==e[A])throw Error("Wrong-Sign");let n=e.length,a=[];for(;n+12<=r.byteLength;){const A=r.getUint32(n,!1),e=o.decode(t.subarray(n+4,n+8)),i=t.subarray(n+8,n+8+A),B=t.subarray(n,n+12+A);if(n+12+A>r.byteLength)break;a.push({type:e,A,data:i,t:B}),n+=12+A}return a})(A,e);return{o:t,i:i(t,"JDAT").map((A=>A.data)),B:i(t,"JDAA").map((A=>A.data)),I:i(t,"IDAT").map((A=>A.t))}})(A),E=new Blob(w.i,a);let g=null;if(w.I?.length>0){const A=w.o.find((({type:A})=>"JHDR"==A));g=new Blob([t,Q(A.data),...w.I,r],n)}else w.B?.length>0&&(g=new Blob(w.B,a));const I={C:"none",l:"default"},l=await createImageBitmap(E,I),c=g?await createImageBitmap(g,I):null,D=await(Promise.try((async()=>{const A=l.width*l.height*4,e=0+A,t=(c?e:0)+A,r=new WebAssembly.Memory({initial:A*(c?4:3)/65536+1}),n=r.buffer,a=(await WebAssembly.instantiate(B,{env:{memory:r}})).instance.exports;await y(l,new Uint8ClampedArray(n,0,A)),c&&(await y(c,new Uint8ClampedArray(n,e,A)),await a.mac(0,0,e,A));const o=await a.wpi(t,0,l.width,l.height);return new Uint8Array(n,t,o)}))?.catch?.(console.warn.bind(console))),h=new Set(["JDAT","JDAA","IDAT","IHDR","JHDR","IEND","JSEP"]),f=w.o.filter((({type:A})=>!h.has(A.toUpperCase()))).map((({t:A})=>A));return new Blob([t,C(l.width,l.height),...f,...s(D),r],n)};