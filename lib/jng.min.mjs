const A=(()=>{const A=[];for(let e=0;e<256;e++){let t=e;for(let A=0;A<8;A++)t=1&t?3988292384^t>>>1:t>>>1;A.push(t)}return A})(),e=new Uint8Array([139,74,78,71,13,10,26,10]),t=new Uint8Array([137,80,78,71,13,10,26,10]),n=new Uint8Array([0,0,0,0,73,69,78,68,174,66,96,130]),r={type:"image/png"},a={type:"image/jpeg"},o=new TextDecoder,i=(new TextEncoder,(A,e)=>A.filter((({type:A})=>A.toUpperCase()==e))),B=(A=>{if(Uint8Array.fromBase64)return Uint8Array.fromBase64(A);if("undefined"==typeof atob)throw Error("No-atob");const e=atob(A),t=e.length,n=new Uint8Array(t);for(let A=0;A<t;A++)n[A]=e.charCodeAt(A);return n})("AGFzbQEAAAABEAJgBH9/f38AYAR/f39/AX8CDwEDZW52Bm1lbW9yeQIAAQMDAgABBw0CA21hYwAAA3dwaQABCuQEAtEBAwF/BHsDfwJAA0AgBCADTw0BIAEgBGr9AAQAIQUgAiAEav0ABAAhBiAGIAb9DQAECAwABAgMAAQIDAAECAwhByAFIAf9DQABAhAEBQYRCAkKEgwNDhMhCCAAIARqIAj9CwQAIARBEGohBAwACwsCQANAIAQgA08NASABIARqIQkgAiAEaiELIAAgBGohCiAKIAktAAA6AAAgCkEBaiAJQQFqLQAAOgAAIApBAmogCUECai0AADoAACAKQQNqIAstAAA6AAAgBEEEaiEEDAALCwuOAwEOfyAAQfgAOgAAIABBAWpBAToAACAAQQJqIQcgAkEEbEEBaiEEIAQgA2whBUEBIQhBACEJQQAhCgJAA0AgCiAFTw0BIAUgCmshDSANQf//AyANQYCABEkbIQwgDCANRiEOIAdBAUEAIA4bOgAAIAdBAWogDEH/AXE6AAAgB0ECaiAMQQh2OgAAIAdBA2pB/wEgDEH/AXFzOgAAIAdBBGpB/wEgDEEIdnM6AAAgB0EFaiEHIAohCwJAA0AgCiALIAxqTw0BIAogBHAhDyAPRQRAIAdBADoAACAHQQFqIQcgCkEBaiEKBSAKIARuIRAgCiAEcEEBayERIAEgECACQQRsbCARamohBiAGLQAAIQ8gByAPOgAAIAggD2ohCCAIQf//A3EhCCAJIAhqIQkgCUH//wNxIQkgB0EBaiEHIApBAWohCgsMAAsLDAALCyAHIAlBCHY6AAAgB0EBaiAJQf8BcToAACAHQQJqIAhBCHY6AAAgB0EDaiAIQf8BcToAACAHQQRqIQcgByAAaw8L"),w=A=>new Uint8Array([A>>>24&255,A>>>16&255,A>>>8&255,255&A]),E=(e,t=-1)=>{let n=t;for(let t=0;t<e.length;t++)n=n>>>8^A[255&(n^e[t])];return~n>>>0},g=A=>{if(A[13])throw Error("No PNG alpha.");const e=new Uint8Array(25);return e.set(new Uint8Array([0,0,0,13,73,72,68,82]),0),e.set(new Uint8Array(A.buffer,A.byteOffset+0,8),8),e.set(new Uint8Array([A[12],0,0,A[14],A[15]]),16),e.set(w(E(e.subarray(4,21))),21),e},I=(A,e)=>{const t=new Uint8Array(25);return t.set(new Uint8Array([0,0,0,13,73,72,68,82]),0),t.set(w(A),8),t.set(w(e),12),t.set(new Uint8Array([8,6,0,0,0]),16),t.set(w(E(t.subarray(4,21))),21),t},Q=async(A,e)=>{const t=new VideoFrame(A,{timestamp:0,alpha:"discard"});return await t.copyTo(e,{format:"RGBX"}),t.close(),e},C=A=>{const e=new Uint8Array([73,68,65,84]);return[w(A.length),e,A,w(E(A,E(e)))]};export const decodeJNG=async A=>{const w=(A=>{const t=((A,e)=>{const t=new Uint8Array(A),n=new DataView(A);for(let A=0;A<e.length;A++)if(t[A]!==e[A])throw Error("Wrong-Sign");let r=e.length,a=[];for(;r+12<=n.byteLength;){const A=n.getUint32(r,!1),e=o.decode(t.subarray(r+4,r+8)),i=t.subarray(r+8,r+8+A),B=t.subarray(r,r+12+A);if(r+12+A>n.byteLength)break;a.push({type:e,A,data:i,t:B}),r+=12+A}return a})(A,e);return{o:t,i:i(t,"JDAT").map((A=>A.data)),B:i(t,"JDAA").map((A=>A.data)),I:i(t,"IDAT").map((A=>A.t))}})(A),E=new Blob(w.i,a);let y=null;if(w.I?.length>0){const A=w.o.find((({type:A})=>"JHDR"==A));y=new Blob([t,g(A.data),...w.I,n],r)}else w.B?.length>0&&(y=new Blob(w.B,a));const s={C:"none",l:"default"},l=await createImageBitmap(E,s),c=y?await createImageBitmap(y,s):null,D=await(Promise.try((async()=>{const A=l.width*l.height*4,e=0+A,t=(c?e:0)+A,n=new WebAssembly.Memory({initial:A*(c?4:3)/65536+1}),r=n.buffer,a=(await WebAssembly.instantiate(B,{env:{memory:n}})).instance.exports;await Q(l,new Uint8ClampedArray(r,0,A)),c&&(await Q(c,new Uint8ClampedArray(r,e,A)),await a.mac(0,0,e,A));const o=await a.wpi(t,0,l.width,l.height);return new Uint8Array(r,t,o)}))?.catch?.(console.warn.bind(console))),h=new Set(["JDAT","JDAA","IDAT","IHDR","JHDR","IEND","JSEP"]),f=w.o.filter((({type:A})=>!h.has(A.toUpperCase()))).map((({t:A})=>A));return new Blob([t,I(l.width,l.height),...f,...C(D),n],r)};